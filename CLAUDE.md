# Claude Code 使用ルール

## MCP（Model Context Protocol）の使用

このプロジェクトでは、必要に応じてMCPサーバーを使用してください。

### 設定済みのMCPサーバー

- **serena**: IDE支援ツール
  - プロジェクトのコンテキストに応じた支援を提供
  - 必要に応じて活用してください

### 使用方針

- コード分析、リファクタリング、ドキュメント生成など、タスクに応じてMCPツールを活用する
- プロジェクトの品質向上に役立つ場合は積極的にMCPを使用する
- 必要性が不明な場合は、使用前に確認する

## 関連プロジェクト

本プロジェクトは、以下のプロジェクトで実施済みの内容を前提としています。

### サーボモーター制御の基礎

- **プロジェクト**: [08-002-rpi-servo-multi-control](https://github.com/Murasan201/08-002-rpi-servo-multi-control)
- **実施済み内容**:
  - サーボモーター動作範囲確認プログラム (`servo_range_test.py`)
  - サーボモーター初期位置設定
  - PWM制御によるサーボモーター制御の基本

本プロジェクトでは、上記の知識を前提として、パン・チルト機構とAI物体検出を組み合わせた追跡カメラシステムを構築します。

## プロジェクト構造

### ドキュメント管理

- **ドキュメントの保存場所**: `docs/` ディレクトリ
- すべてのプロジェクトドキュメント、設計書、手順書、メモなどは `docs/` ディレクトリ内に保存してください
- ドキュメントファイルは適切な名前を付けて整理すること
- 必要に応じてサブディレクトリを作成して分類すること

## 開発方針

### 基本方針

本プロジェクトは**技術書に掲載するサンプルコード**です。以下の方針に従ってください。

### コードの品質基準

- **初心者にもわかりやすいコード**を最優先とする
- 変数名・関数名は意味が明確で理解しやすいものを使用
- 適切なコメントを付けて処理の意図を説明
- 複雑な処理は避け、シンプルな実装を心がける

### MVP（最小構成）の原則

- **必要最小限の機能**のみを実装する
- 過度な抽象化・汎用化は行わない
- 設定ファイルや外部依存は最小限に抑える
- 1つのファイルで完結できる場合は分割しない
- エラーハンドリングは必要最低限とし、学習の妨げにならないようにする

### 実装の優先順位

1. **動作すること** - まず正しく動くコードを書く
2. **読みやすいこと** - 初心者が理解できるコードにする
3. **シンプルであること** - 余計な機能や複雑さを排除する

### 修正禁止ファイル・ディレクトリ

- **`_full` が付いているファイルは絶対に修正しないこと**
- これらのファイルは実機動作確認済みでFixされている
- 例: `servo_control_full.py`, `servo_initial_position_setup_full.py`, `setup_servo_center_full.py`

- **`reference/` ディレクトリ内のファイルは一切変更しないこと**
- 参照用データが格納されている
- 読み取り専用として扱う

### servo_control.py の互換性要件

**重要**: `servo_control.py` は外部プロジェクトからライブラリとして使用されている。

- **依存プロジェクト**: `reference/12-002-pet-monitoring-yolov8`
- **仕様書**: `docs/servo_control_specification.md`

MVP化する際は、以下の**必須API**のシグネチャを変更してはならない：
- `initialize_servo_kit()`
- `set_pan_angle(kit, angle, smooth=True)`
- `set_tilt_angle(kit, angle, smooth=True)`
- `set_pan_tilt(kit, pan_angle, tilt_angle, smooth=True)`
- `set_center_position(kit, smooth=True)`
- `release_servos(kit)`

内部実装の簡略化やテスト関数の削除は可。

## Git操作とセキュリティ

### 機密情報の管理

**重要**: gitにコミット・プッシュする前に、必ず機密情報が含まれていないか入念にチェックすること

#### チェック項目
1. **原稿ファイル**: `chapter12_manuscript.md` が `.gitignore` に含まれているか確認
2. **個人情報**: コード内に個人情報（名前、メールアドレス、パスワード等）が含まれていないか
3. **APIキー・トークン**: 認証情報やAPIキーが含まれていないか
4. **実験データ**: 個人を特定できる画像や動画が含まれていないか
5. **設定ファイル**: ローカル固有の設定が含まれていないか

#### コミット前の確認手順
```bash
# 1. git statusでステージングされているファイルを確認
git status

# 2. 各ファイルの内容を確認
git diff --cached

# 3. .gitignoreが正しく機能しているか確認
git check-ignore -v chapter12_manuscript.md

# 4. 問題なければコミット
git commit -m "コミットメッセージ"
```

#### 除外すべきファイル（.gitignoreに記載）
- 原稿ファイル（`chapter12_manuscript.md`）
- 実験データ（画像、動画、ログファイル等）
- 個人情報を含むファイル
- ローカル固有の設定ファイル
