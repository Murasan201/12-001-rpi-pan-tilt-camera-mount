# パン・チルトカメラマウント プロジェクト仕様書

**バージョン**: 1.1
**作成日**: 2025-12-14
**プロジェクト名**: 12-001-rpi-pan-tilt-camera-mount
**対象書籍**: 第12章「AIにチャレンジ応用編②動くものを追いかける！AI追跡カメラの作成」

---

## 1. プロジェクト概要

### 1.1 目的
本プロジェクトは、書籍原稿（第12章）の技術検証を目的とし、サーボモーターでカメラの向きを自動的に変える「パン・チルト機構」を構築します。将来的にはYOLOv8による物体検出と組み合わせて、ペットを自動的に追いかける見守りカメラシステムを実現します。

### 1.2 前提プロジェクト
本プロジェクトは、以下のプロジェクトで実施済みの内容を前提としています：
- **プロジェクト**: [08-002-rpi-servo-multi-control](https://github.com/Murasan201/08-002-rpi-servo-multi-control)
- **実施済み内容**:
  - サーボモーター動作範囲確認プログラム (`servo_range_test.py`)
  - サーボモーター初期位置設定
  - PWM制御によるサーボモーター制御の基本

### 1.3 開発方針
- 原稿（`chapter12_manuscript.md`）に記載されているソースコードは**そのまま使用**する
- 動作確認前にコードを勝手に修正・改善しない
- 実機動作確認後、修正が必要な箇所のみを特定し、原稿に反映する

---

## 2. ハードウェア構成

### 2.1 必要な部品
| 部品名 | 型番/仕様 | 数量 | 用途 |
|--------|----------|------|------|
| Raspberry Pi | Raspberry Pi 5（またはRaspberry Pi 4） | 1 | メインコントローラ |
| カメラモジュール | Raspberry Pi カメラモジュール v3 | 1 | 映像撮影 |
| サーボドライバ | Adafruit 16-Channel PWM / Servo HAT for Raspberry Pi - Mini Kit | 1 | サーボモーター制御（PCA9685チップ搭載） |
| サーボモーター | SG90サーボモーター | 2 | パン・チルト動作 |
| マウントキット | SG90サーボ用パン・チルトマウントキット | 1 | カメラ取り付け |
| ジャンパーワイヤ | オス-メス型 | 10本程度 | 配線 |

### 2.2 接続仕様
- **パン（左右）用サーボ**: サーボHATの0番端子
- **チルト（上下）用サーボ**: サーボHATの1番端子
- **通信方式**: I2C通信
- **PWM周波数**: 50Hz
- **パルス幅範囲**: 750μs ～ 2250μs

---

## 3. ソフトウェア要件

### 3.1 動作環境
- **OS**: Raspberry Pi OS（最新版）
- **Python**: Python 3.7以上
- **通信プロトコル**: I2C

### 3.2 必要なPythonライブラリ
```bash
# パッケージ管理ツール
python3-pip

# Adafruit CircuitPythonライブラリ
adafruit-circuitpython-servokit  # サーボモーター制御（ServoKit）
```

### 3.3 依存ライブラリ
```python
import time                        # 時間制御
from adafruit_servokit import ServoKit  # サーボモーター制御
```

---

## 4. パン・チルト機構の仕様

### 4.1 用語定義
- **パン（Pan）**: 水平方向（左右）の動き
- **チルト（Tilt）**: 垂直方向（上下）の動き
- **サーボホーン**: サーボモーターの出力軸に取り付ける部品

### 4.2 動作範囲
- **理論上の可動範囲**: 0度 ～ 180度
- **推奨動作範囲**:
  - パンサーボ: 30度 ～ 150度
  - チルトサーボ: 45度 ～ 120度（物理的制約により上限を135度から変更）
- **中央位置**: 90度（初期設定時の基準位置）

### 4.3 制御パラメータ
- **PWM周波数**: 50Hz
- **最小パルス幅**: 750μs
- **最大パルス幅**: 2250μs
- **角度分解能**: 1度単位

---

## 5. 実装プログラム仕様

### 5.1 サーボモーター初期位置設定プログラム

**ファイル名**: `servo_initial_position_setup.py`

#### 5.1.1 目的
- サーボモーターを中央位置（90度）に設定
- サーボホーン取り付け前の初期位置調整

#### 5.1.2 機能
- 両サーボ（パン・チルト）を90度に設定
- 位置を保持し続ける（Ctrl+Cで終了）

#### 5.1.3 実行コマンド
```bash
python3 servo_initial_position_setup.py
```

---

### 5.2 サーボモーター動作範囲確認プログラム

**ファイル名**: `servo_range_test.py`

**注**: このプログラムは関連プロジェクト [08-002-rpi-servo-multi-control](https://github.com/Murasan201/08-002-rpi-servo-multi-control) で既に実施済み

#### 5.2.1 目的
- パン・チルトマウントの物理的制約に応じた安全な動作範囲の確認
- 機械的干渉の検出
- 推奨動作範囲の決定

#### 5.2.2 機能
1. **パンサーボの範囲確認**
   - 中央位置（90度）から開始
   - 左方向: 80, 70, 60, 50, 40, 30, 20, 10, 0度と段階的にテスト
   - 右方向: 100, 110, 120, 130, 140, 150, 160, 170, 180度と段階的にテスト
   - 各角度でユーザーに問題の有無を確認（y/n入力）

2. **チルトサーボの範囲確認**
   - 中央位置（90度）から開始
   - 下方向: 80, 70, 60, 50, 40, 30, 20, 10, 0度と段階的にテスト
   - 上方向: 100, 110, 120, 130, 140, 150, 160, 170, 180度と段階的にテスト
   - 各角度でユーザーに問題の有無を確認（y/n入力）

3. **結果の出力**
   - パンサーボの推奨動作範囲を表示
   - チルトサーボの推奨動作範囲を表示
   - テスト完了後、中央位置（90度）に復帰

#### 5.2.3 テスト手順
1. 各角度に移動（移動時間: 1秒待機）
2. ユーザーに問題の有無を確認
3. 問題がある場合（n入力）: 前の角度を安全範囲として記録
4. 問題がない場合（y入力）: 次の角度へ進む

#### 5.2.4 実行コマンド
```bash
python3 servo_range_test.py
```

---

## 6. システムアーキテクチャ

### 6.1 制御フロー
```
Raspberry Pi
    ├── I2C通信
    │   └── PCA9685 PWMコントローラ（Adafruit Servo HAT）
    │       ├── チャンネル0: パンサーボ
    │       └── チャンネル1: チルトサーボ
    │
    └── CSI-2インターフェース
        └── Raspberry Pi カメラモジュール v3
```

### 6.2 初期化シーケンス
1. ServoKitの初期化（16チャンネル）
2. パルス幅範囲の設定（750～2250μs）
3. サーボ角度の設定

### 6.3 エラーハンドリング
- **KeyboardInterrupt**: Ctrl+Cによる中断処理

---

## 7. セットアップ手順

### 7.1 システム更新
```bash
sudo apt update && sudo apt upgrade -y
sudo reboot
```

### 7.2 Pythonライブラリのインストール
```bash
# pipのインストール/更新
sudo apt update
sudo apt install python3-pip

# Adafruit ServoKitライブラリのインストール
sudo pip3 install adafruit-circuitpython-servokit
```

### 7.3 インストール確認
```bash
python3
>>> from adafruit_servokit import ServoKit
>>> exit()
```

### 7.4 ハードウェア組み立て
1. Raspberry Piの電源を切る
2. Adafruit Servo HATをRaspberry Piに取り付け
3. サーボモーターをサーボHATに接続
   - パンサーボ: 0番端子
   - チルトサーボ: 1番端子
4. パン・チルトマウントキットの組み立て
5. カメラモジュールをマウントに取り付け
6. カメラをRaspberry Piのカメラコネクタに接続

### 7.5 初期位置設定
1. `servo_initial_position_setup.py` を実行（サーボが90度に移動）
2. サーボホーンを取り付け
3. Ctrl+Cでプログラムを終了
4. `servo_control.py` を実行して動作テスト

---

## 8. 今後の拡張予定

### 8.1 物体検出機能
- YOLOv8による物体検出の実装
- リアルタイム画像処理
- 検出対象: ペット（犬、猫など）

### 8.2 自動追跡機能
- 検出した物体の位置に基づくサーボモーター制御
- カメラの自動追従
- 見守りカメラシステムの構築

### 8.3 追加予定機能
- Webインターフェースによる遠隔操作
- 録画機能
- 通知機能

---

## 9. 技術仕様まとめ

### 9.1 サーボモーター制御仕様
| 項目 | 仕様 |
|------|------|
| 制御IC | PCA9685 |
| 通信方式 | I2C |
| PWM周波数 | 50Hz |
| パルス幅範囲 | 750μs ～ 2250μs |
| 角度範囲 | 0° ～ 180° |
| 角度分解能 | 1° |
| サーボ接続数 | 2個（パン、チルト） |

### 9.2 プログラム一覧
| ファイル名 | 目的 | 実施状況 |
|-----------|------|---------|
| `servo_initial_position_setup.py` | 初期位置設定と動作テスト | 本プロジェクトで実装 |
| `servo_range_test.py` | 動作範囲確認 | 関連プロジェクトで実施済み |

---

## 10. 参考資料

### 10.1 関連ドキュメント
- 原稿: `chapter12_manuscript.md`（機密情報、git管理外）
- ルールファイル: `CLAUDE.md`

### 10.2 関連プロジェクト
- [08-002-rpi-servo-multi-control](https://github.com/Murasan201/08-002-rpi-servo-multi-control)

### 10.3 ハードウェア資料
- Adafruit 16-Channel PWM / Servo HAT for Raspberry Pi
- SG90 サーボモーター データシート
- Raspberry Pi カメラモジュール v3 仕様書

---

## 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2025-12-14 | 初版作成 |
| 1.1 | 2025-12-18 | チルトサーボ上限を135度→120度に変更（物理的制約による） |
